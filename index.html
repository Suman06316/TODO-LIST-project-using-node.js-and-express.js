<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tech mecha torque task</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f9f9f9;
    }

    .todo-container {
      max-width: 500px;
      margin: 50px auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .todo-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }

    .todo-item:last-child {
      border-bottom: none;
    }

    .todo-actions button {
      margin-left: 5px;
    }

    .completed {
      text-decoration: line-through;
      opacity: 0.6;
    }
  </style>
</head>

<body onload="loadTodos()">

  <div class="todo-container">
    <h3 class="text-center mb-4">To-Do List</h3>
    
    <div class="input-group mb-3">
      <input id="todo-input" type="text" class="form-control" placeholder="Enter a task" />
      <button class="btn btn-primary" onclick="addTodo()">Add</button>
    </div>

    <ul id="todo-list" class="list-unstyled"></ul>
  </div>

  <script>
    var editingId = null;

    function loadTodos() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'http://localhost:3000/todos');
      xhr.onload = function() {
        var todos = JSON.parse(xhr.responseText);
        var list = document.getElementById('todo-list');
        list.innerHTML = '';
        
        for (var i = 0; i < todos.length; i++) {
          var todo = todos[i];
          var li = document.createElement('li');
          li.className = 'todo-item';
          if (todo.completed) li.className += ' completed';
          
          if (editingId === todo.id) {
            li.innerHTML = '<input id="edit-input" class="form-control" value="' + todo.task + '" style="flex-grow:1">' +
              '<div class="todo-actions">' +
              '<button class="btn btn-sm btn-success" onclick="saveEdit(' + todo.id + ')">Save</button>' +
              '<button class="btn btn-sm btn-secondary" onclick="cancelEdit()">Cancel</button>' +
              '</div>';
          } else {
            li.innerHTML = '<span>' + todo.task + '</span>' +
              '<div class="todo-actions">' +
              '<button class="btn btn-sm btn-success" onclick="toggleTodo(' + todo.id + ',' + !todo.completed + ')">' + 
              (todo.completed ? 'Undo' : 'Done') + '</button>' +
              '<button class="btn btn-sm btn-warning" onclick="editTodo(' + todo.id + ')">Edit</button>' +
              '<button class="btn btn-sm btn-danger" onclick="deleteTodo(' + todo.id + ')">Delete</button>' +
              '</div>';
          }
          
          list.appendChild(li);
        }
      };
      xhr.send();
    }

    function addTodo() {
      var input = document.getElementById('todo-input');
      var task = input.value.trim();
      if (!task) return alert('Enter a task!');
      
      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'http://localhost:3000/todos');
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.onload = function() {
        input.value = '';
        loadTodos();
      };
      xhr.send(JSON.stringify({ task: task }));
    }

    function toggleTodo(id, completed) {
      var xhr = new XMLHttpRequest();
      xhr.open('PUT', 'http://localhost:3000/todos/' + id);
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.onload = function() { loadTodos(); };
      xhr.send(JSON.stringify({ completed: completed }));
    }

    function editTodo(id) {
      editingId = id;
      loadTodos();
    }

    function saveEdit(id) {
      var input = document.getElementById('edit-input');
      var task = input.value.trim();
      if (!task) return alert('Task cannot be empty!');
      
      var xhr = new XMLHttpRequest();
      xhr.open('PUT', 'http://localhost:3000/todos/edit/' + id);
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.onload = function() {
        editingId = null;
        loadTodos();
      };
      xhr.send(JSON.stringify({ task: task }));
    }

    function cancelEdit() {
      editingId = null;
      loadTodos();
    }

    function deleteTodo(id) {
      if (!confirm('Delete this task?')) return;
      var xhr = new XMLHttpRequest();
      xhr.open('DELETE', 'http://localhost:3000/todos/' + id);
      xhr.onload = function() { loadTodos(); };
      xhr.send();
    }
  </script>

</body>
</html>